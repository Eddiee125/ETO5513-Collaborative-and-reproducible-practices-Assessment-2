---
title: "Sleep-Quality"
author: 
  - name: "Savaira Manoa"
  - name: "Adrian Pouflis"
  - name: "Eduard Vargas"
affiliation: "**Monash Student ID: 34322450**"
date: "2024-06-01"
output: 
  bookdown::html_document2:
    number_sections: false
  bookdown::pdf_document2:
    number_sections: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```



#### Section 1: Loading the libraries
```{r Loading the libraries, include=FALSE}
# Loading the libraries
library(dplyr)
library(tidyr)
library(knitr)
library(kableExtra)
library(ggplot2)
library(scales)
library(RColorBrewer)
library(viridis)
library(htmltools)
library(interactions)

```


#### Research Question:
What is the impact of various lifestyle choices on sleep quality among adults?

#### Introduction to the data set.

The data set utilized for this work was obtained from Kaggle.
 
Kaggle is a website and collection of services for data science. It provides a platform for users to find and share datasets, as well as compete in machine learning competitions. This data set does mention the license is under the Authors, who is listed as 'Equilibrium', but this author doesn't elaborate on their data's source. Despite this, the dataset is highly rated and has been used by others for academic purposes.


#### Data Set Introduction:

```{r Loading Data}
## Loading the data set
raw_data <- read.csv("Sleep_Efficiency.csv",header = TRUE)
```


The following are the variables identified in the data set.
```{r Looking at variables}
# Identifying the variables:

print(colnames(raw_data))
```

As the intention of this collaborative project is to answer the question of : _"What is the impact of various lifestyle choices on sleep quality among adults?"_, instead of analysing everything, we will determine and analysis a few key variables impact on sleep quality.

**Explanation of the Raw Data:**
```{r}
print(str(raw_data))
print(summary(raw_data))
```

 - **Analysis of the data encountered:**
 
The data set provides comprehensive information on sleep quality and related factors for a group of 452 individuals. The dataset includes demographic information such as age, and gender. Detailed sleep metrics are recorded, including bedtime, wakeup time, total sleep duration, and sleep efficiency. Additionally, the dataset measures the percentage of sleep spent in different stages: REM, deep, and light sleep. The number of awakenings during the night is also recorded.
 
Beyond sleep-specific data, the dataset captures lifestyle factors that may influence sleep quality. These factors include caffeine/alcohol consumption, smoking status, and exercise frequency. The dataset contains some missing values in the columns for awakenings, caffeine consumption, alcohol consumption, and exercise frequency. Overall, this dataset is well-suited for investigating the relationships between sleep quality and various demographic and lifestyle factors, offering insights into how behaviors and characteristics impact sleep patterns and efficiency.

The table above summarises important information about the variables.



The "Sleep efficiency" feature is a measure of the proportion of time spent in bed spent asleep. 


### Gender and excercise variables:


In order to understand the data a sleeping efficiency, which was defined by the author as ***"A measure of the proportion of time spent in bed that is actually spent asleep."***, we decided to use a simple linear regression model in order to find the relationships between the habits of an adult person, and the consequences on the mentioned sleeping efficiency.


Here, the intercept, or dependent variable will be "Sleep Efficiency":


```{r Cleaning data}
# Clean data by removing rows with missing values
cleaned_data <- na.omit(raw_data)

# Fit a linear model to predict Sleep.efficiency
Linear_model <- lm(Sleep.efficiency ~ Age + Caffeine.consumption + Alcohol.consumption + Exercise.frequency + Gender, data = cleaned_data)

# Get a summary of the model
summary(Linear_model)
```


**Observations:**

The linear model analysis reveals several significant relationships between the predictors and sleep efficiency. The model explains about 25.84% of the variability in sleep efficiency (R-squared = 0.2584). Key predictors such as age, alcohol consumption, and exercise frequency have significant effects on sleep efficiency, while caffeine consumption is not a significant predictor. The intercept indicates the baseline sleep efficiency when all predictors are at zero, and the overall model is statistically significant (p-value < 2.2e-16).

**Specific Observations:**

 - Gender:
Coefficient for Gender (Male): -0.0219210
Interpretation: On average, males have a sleep efficiency that is approximately 2.19% lower than females, although this effect is only marginally significant (p = 0.094462).
Significance: The marginal significance suggests that while there is a difference in sleep efficiency between genders, it is not as strongly supported by the data compared to other predictors.

- Exercise Frequency
Coefficient for Exercise Frequency: 0.0261673

**Interpretation:** Each additional day of exercise per week is associated with a 2.62% increase in sleep efficiency, holding other factors constant.

**Significance:** This relationship is highly significant (p = 1.72e-09), indicating a strong positive impact of exercise on sleep efficiency.

**Summary:**
The linear model highlights that while gender has a marginal impact on sleep efficiency, exercise frequency has a robust positive effect. These insights can inform strategies to improve sleep quality, particularly emphasizing the benefits of regular exercise.




After understanding the relevant variables that affect the "Sleeping Efficiency" it is important to visualize how the current information is, and then proceed to work on more relationships with the help of the model elaborated:

```{r Visualizing the data Gender-Excercise 4}
gender_exercise <- cleaned_data %>%
    select(Gender, Sleep.efficiency, Exercise.frequency)


summary_by_gender <- gender_exercise %>%
    group_by(Gender) %>%
    summarise(
        Min_Sleep_Efficiency = min(Sleep.efficiency, na.rm = TRUE),
        Max_Sleep_Efficiency = max(Sleep.efficiency, na.rm = TRUE),
        Mean_Sleep_Efficiency = mean(Sleep.efficiency, na.rm = TRUE)
    )

```

```{r Printint the tables}
kable(summary_by_gender, caption = "Summary of Sleep Efficiency by Gender")
```

Now let's have a look at the distribution of exercise frequency 

```{r Histogram visualizing the distribution, fig.align='right', fig.align='center'}
# Create histograms for each exercise frequency, faceted by gender
ggplot(gender_exercise, aes(x = Sleep.efficiency, fill = Gender)) +
  geom_histogram(binwidth = 0.05, alpha = 0.6, position = "identity") +
  facet_wrap(~ Exercise.frequency) +
  labs(title = "Distribution of Sleep Efficiency by Exercise Frequency and Gender",
       x = "Sleep Efficiency",
       y = "Count") +
  theme_minimal()

```



Now, if we were to plot the information for sleeping quality vs exercise levels by gender, it would look like this:

```{r Plotting the relationship, fig.align='center'}
Gender_Exercise_SE_Plot <- 
    ggplot(gender_exercise, aes(x = Exercise.frequency, y = Sleep.efficiency, color = Gender)) +
    geom_point()+
    labs( title = "Relationship between excercise and Sleep Efficiency by Gender",
          x = "Exercise Frequency",
          y = "Sleep Efficiency",
          color = "Gender") +
    theme_minimal()

print(Gender_Exercise_SE_Plot)
```


### Age and alcohol consumption analysis:
-Adrian Pouflis

**Research Question**

As identified in Eduard's earlier analysis, using linear regression, age and alcohol consumption both have significant impacts on sleep efficiency. Alcohol consumption had a significantly larger magnitude of impact than age, its direction was negative.

I have two primary research questions relating to these variables.

How do these variables impact quality of sleep independently?

Does one variable have a moderating effect on the other? (For example, maybe the impact of alcohol increases with age.)

**Analysis - Question 1**

With regards to the first research question, a relationship between the variables and sleep efficiency has already been quantified. For each point of alcohol consumption, sleep efficiency decreases by 3.36%. Age seems to actually have an extremely small impact, a less than 1% (~0.1664%) increase in sleep efficiency with age. Both results were found to be statistically significant. 

These effects are fairly moderate in scope, as was noted already, the linear regression explains only about 25.84% of the variance in sleep efficiency. Repeating the process on other test variables (Awakenings and sleep duration) below, similarly low R-squared values can be seen.

```{r}
Linear_model_duration <- lm(Sleep.duration ~ Age + Caffeine.consumption + Alcohol.consumption + Exercise.frequency + Gender, data = cleaned_data)

duration_r_squared = summary(Linear_model_duration)$r.squared


Linear_model_awakenings <- lm(Awakenings ~ Age + Caffeine.consumption + Alcohol.consumption + Exercise.frequency + Gender, data = cleaned_data)

awakening_r_squared = summary(Linear_model_awakenings)$r.squared

cat("\nThe r-squared value for the linear model on sleep duration is",duration_r_squared)

cat("\nThe r-squared value for the linear model on number of awakenings is",awakening_r_squared)

```
Alcohol consumption ranged between doses of 0 and 5. Let's examine sleep efficiency for each value of alcohol consumption.

```{r}
alcohol_data <- cleaned_data %>%
    select(Sleep.efficiency, Alcohol.consumption)


summary_by_alcohol <- alcohol_data %>%
    group_by(Alcohol.consumption) %>%
    summarise(
        Mean_Sleep_Efficiency = mean(Sleep.efficiency, na.rm = TRUE)
    )

summary_by_alcohol
```

Overall, the relationship between alcohol consumption and sleep efficiency seems uncertain, lower amounts of alcohol do see higher efficiency, but the value spikes at a value of 3 and the regression indicates the effect is somewhat weak. 

Repeating the process with age:

```{r}
Age_bands <- cut(cleaned_data$Age, c(seq(9, 70, by = 5), Inf), include.lowest = TRUE)

aggregate(Sleep.efficiency ~ Age_bands, cleaned_data, mean)
```
Sleep efficiency would appear to peak around the 29-59 range, falling in later years and being lowest in 
adolescent years.

**Analysis - Question 2**

Now I've explored the impact of these variables independently, what remains is to see how one variable can change the impact of another. I'll use two very simple tests for this.


This process will be done using moderation analysis.
```{r}
# Perform regression, this time using a different formula to determine moderation effect
Moderation_model <- lm(Sleep.efficiency ~ Age + Caffeine.consumption + Alcohol.consumption + Exercise.frequency + Gender + Age * Alcohol.consumption, data = cleaned_data)
summary(Moderation_model)

interactions::interact_plot(Moderation_model, pred = Age, modx = Alcohol.consumption)
```
The moderation effect is also visualised. The different lines represent different levels of alcohol consumption, while their slope indicates the relationship between age and sleep efficiency. These lines are close to parallel, meaning for each different level of alcohol consumption, the relationship between the age and sleep efficiency variables are unchanged. More simply, the interaction effect is extremely small.

The prior variables are about as predicted before, with some variation due to the change in model makeup. R squared has improved by an extremely marginal amount. 

The last variable, 'Age:Alcohol.consumption' indicates that the relationship between age and sleep efficiency decreases as alcohol consumption increases.

Given that age has been established to have a strongest connection with sleep efficiency in the 29-59 age band, I re-ran the model within this age range.


```{r}
#Only select values with age between 20-59
Age_selected_data <- cleaned_data[cleaned_data$Age > 59 | cleaned_data$Age < 29 ,] 

# Perform regression, this time using a different formula to determine moderation effect
Moderation_model <- lm(Sleep.efficiency ~ Age + Caffeine.consumption + Alcohol.consumption + Exercise.frequency + Gender + Age * Alcohol.consumption, data = Age_selected_data)
summary(Moderation_model2)
```
The effect of Age:Alcohol.consumption does increase, but is very small. R-squared decreases and the effect of age doesn't change, this indicates the model overall isn't much better than one with a full age range.

#### Citations:

Equilibrium. (2023). *Sleep efficiency* [Data set]. Kaggle. [https://www.kaggle.com/datasets/equilibriumm/sleep-efficiency](https://www.kaggle.com/datasets/equilibriumm/sleep-efficiency)
